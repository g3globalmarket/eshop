Verifying the fix is in place and correct:


[4 tools called]


The fix is in place. Summary:

## CI smoke test fix â€” complete

### Changes applied

**1. GitHub Actions workflow** (`.github/workflows/docker-build.yml`)

**Step updated:** `Smoke test built image` (lines 264-300)

**Changes:**
- Lines 269-275: Conditional secret generation before container start
- Lines 282-283: Secrets injected into container

**Implementation:**
```yaml
      - name: Smoke test built image
        if: steps.check-image.outputs.exists == 'false' || needs.detect-changes.outputs.has-backend-changes == 'true'
        run: |
          docker pull ${{ env.DOCKER_USERNAME }}/${{ matrix.service }}:latest

          # Generate dummy secrets for smoke test (only if not already set)
          if [ -z "$ACCESS_TOKEN_SECRET" ]; then
            export ACCESS_TOKEN_SECRET=$(openssl rand -hex 32)
          fi
          if [ -z "$REFRESH_TOKEN_SECRET" ]; then
            export REFRESH_TOKEN_SECRET=$(openssl rand -hex 32)
          fi

          CONTAINER_NAME="smoke-test-${{ matrix.service }}"
          docker run -d --name "$CONTAINER_NAME" \
            -e NODE_ENV=production \
            -e DATABASE_URL="mongodb://localhost:27017/test" \
            -e JWT_SECRET="test-secret-for-smoke-test" \
            -e ACCESS_TOKEN_SECRET="$ACCESS_TOKEN_SECRET" \
            -e REFRESH_TOKEN_SECRET="$REFRESH_TOKEN_SECRET" \
            ...
```

**2. Local smoke test script** (`scripts/smoke-run-images.sh`)

**Location:** Lines 132-150 (before auth-service container start)

**Changes:**
- Lines 132-138: Conditional secret generation
- Lines 149-150: Secrets injected into container

**Implementation:**
```bash
# Generate dummy secrets for smoke test (only if not already set)
if [ -z "$ACCESS_TOKEN_SECRET" ]; then
  export ACCESS_TOKEN_SECRET=$(openssl rand -hex 32)
fi
if [ -z "$REFRESH_TOKEN_SECRET" ]; then
  export REFRESH_TOKEN_SECRET=$(openssl rand -hex 32)
fi

# Start container with minimal env (safe placeholders)
docker run -d \
  --name test-auth \
  --network ${NETWORK_NAME} \
  -e NODE_ENV=production \
  -e DATABASE_URL="mongodb://localhost:27017/test" \
  -e JWT_SECRET="test-secret-for-smoke-test-only" \
  -e ACCESS_TOKEN_SECRET="$ACCESS_TOKEN_SECRET" \
  -e REFRESH_TOKEN_SECRET="$REFRESH_TOKEN_SECRET" \
  ...
```

### Requirements met

- Conditional generation: Only generates if vars are not already set
- No secrets in logs: Values are not echoed or printed
- Minimal diff: Only 2 files changed
- Production unchanged: Only affects smoke test execution
- Runtime-only: Secrets generated during CI run, never committed

### Expected result

The `smoke-test-auth-service` container should:
- Start successfully with generated dummy secrets
- Not exit with `[FATAL] Missing required environment variables`
- Pass the smoke test validation

### Verification

To verify locally:
```bash
./scripts/smoke-run-images.sh
```

The auth-service container should start and remain running without the fatal error.

The fix is complete and ready for CI testing. The smoke test should now pass for auth-service.