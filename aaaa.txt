Locating where seller-ui sets its API base URL.


[6 tools called]


Reviewing the files to understand the current setup:


[6 tools called]


Searching for seller routes in the API gateway:


[5 tools called]


Checking the seller-service route structure:


[3 tools called]


Checking where create-shop is defined:


[3 tools called]


Implementing the fixes:


[16 tools called]


Fixing the login page import:


[5 tools called]


Checking if seller-ui needs NEXT_PUBLIC_SERVER_URI in docker-compose:


[3 tools called]


## Summary

### Root cause
- seller-ui used `baseURL: ""` (same-origin), so requests went to `sellers.nomadnet.shop/api/*` (404)
- `create-shop` called `/api/create-shop` instead of `/auth/api/create-shop`
- `refresh-token` didn't use baseURL
- Dockerfile defaulted to `https://sellers.nomadnet.shop` instead of the backend domain

### Files changed

**1. `apps/seller-ui/src/utils/axiosInstance.tsx`**
```typescript
// Before:
const axiosInstance = axios.create({
  baseURL: "",
  withCredentials: true,
});

// After:
const axiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_SERVER_URI || "http://localhost:8080",
  withCredentials: true,
});
```
- Also fixed refresh-token to use baseURL

**2. `apps/seller-ui/src/shared/modules/auth/create-shop.tsx`**
```typescript
// Before:
await axios.post(`/api/create-shop`, data)

// After:
await axiosInstance.post(`/auth/api/create-shop`, data)
```
- Changed path from `/api/create-shop` to `/auth/api/create-shop` (correct backend route)
- Uses `axiosInstance` (with baseURL) instead of raw `axios`

**3. `apps/seller-ui/src/app/(routes)/login/page.tsx`**
- Changed to use `axiosInstance` instead of raw `axios`
- Ensures login requests use correct baseURL

**4. `apps/seller-ui/Dockerfile`**
```dockerfile
# Before:
ARG NEXT_PUBLIC_SERVER_URI=https://sellers.nomadnet.shop

# After:
ARG NEXT_PUBLIC_SERVER_URI=https://nomadnet.shop
```

**5. `docker-compose.production.yml`**
- Added `NEXT_PUBLIC_SERVER_URI` and `NEXT_PUBLIC_CHATTING_WEBSOCKET_URI` to seller-ui environment
- Note: Next.js bakes `NEXT_PUBLIC_*` vars at build time, so the image must be rebuilt with the correct ARG

**6. `LOCAL_AUDIT_REPORT.md`**
- Updated seller-ui section with fix details

---

### Verification steps

**In browser DevTools Network tab:**
1. Create shop request:
   - Before: `POST https://sellers.nomadnet.shop/api/create-shop` → 404
   - After: `POST https://nomadnet.shop/auth/api/create-shop` → 200/201 or 401 (if auth missing)
2. Refresh token request:
   - Before: `POST https://sellers.nomadnet.shop/auth/api/refresh-token` → 400
   - After: `POST https://nomadnet.shop/auth/api/refresh-token` → 200 or 401
3. Login request:
   - After: `POST https://nomadnet.shop/auth/api/login-seller` → 200
4. Check Request Headers:
   - Should include `cookie:` header (withCredentials: true)

---

### Deployment notes

Important: Next.js bakes `NEXT_PUBLIC_*` environment variables at build time, not runtime.

To deploy:
1. Rebuild seller-ui image with correct ARG:
   ```bash
   docker build --build-arg NEXT_PUBLIC_SERVER_URI=https://nomadnet.shop -t seller-ui:latest .
   ```
2. Or ensure `.env` has `NEXT_PUBLIC_SERVER_URI=https://nomadnet.shop` before build
3. The docker-compose `environment:` vars won't work for `NEXT_PUBLIC_*` (they're build-time only)

---

### Expected results

After fix and rebuild:
- ✅ `create-shop` → `https://nomadnet.shop/auth/api/create-shop` (not 404)
- ✅ `refresh-token` → `https://nomadnet.shop/auth/api/refresh-token` (not 400)
- ✅ `login-seller` → `https://nomadnet.shop/auth/api/login-seller` (works)
- ✅ Cookies included in requests (withCredentials: true)
- ✅ All API requests go to backend domain, not seller-ui domain

---

**Status:** seller-ui now routes API requests to the backend (api-gateway) instead of its own Next.js /api routes. The fix requires rebuilding the seller-ui image with the correct `NEXT_PUBLIC_SERVER_URI` build arg.